# Excalidraw + Cerebras AI Whiteboard POC Plan

## Objective
Build a proof-of-concept demonstrating AI-powered React component generation on an Excalidraw canvas, validating sub-5-second generation speeds using Cerebras and creating an intuitive whiteboard experience where users can prompt, generate, and manipulate AI-created micro-apps.

## Context
- **Created**: 2025-01-30
- **Last Updated**: 2025-08-03
- **Status**: [ ] Not Started / [x] In Progress / [ ] Completed
- **Complexity**: Medium
- **Duration**: 3 days (estimated)
- **Progress**: Core functionality working (~50% complete)
- **Key Innovation**: Combining Excalidraw's whiteboard with overlay React components generated by Cerebras AI

## Prerequisites
- [ ] Cerebras API access and key obtained
- [ ] Node.js and npm installed
- [ ] Basic React knowledge
- [ ] Understanding of Excalidraw library basics

## Relevant Resources
### Guides
- `/docs/ideas/ai-whiteboard-virtual-meeting/plans/bit-dev-fullstack-canvas-research/poc-excalidraw-final-plan.md`
- `/docs/ideas/ai-whiteboard-virtual-meeting/plans/bit-dev-fullstack-canvas-research/excalidraw-integration-plan.md`
- `/docs/ideas/ai-whiteboard-virtual-meeting/plans/bit-dev-fullstack-canvas-research/ai-generation-architecture.md`

### Files to Create
- `ai-whiteboard-poc/src/App.jsx` - Main application
- `ai-whiteboard-poc/src/components/ExcalidrawCanvas.jsx` - Canvas integration
- `ai-whiteboard-poc/src/components/GenerationDialog.jsx` - Prompt interface
- `ai-whiteboard-poc/src/components/AppOverlay.jsx` - Component positioning
- `ai-whiteboard-poc/src/components/GeneratedApp.jsx` - Dynamic component renderer
- `ai-whiteboard-poc/src/services/cerebras.js` - AI service integration

### Documentation
- [Excalidraw React Documentation](https://docs.excalidraw.com)
- [Cerebras API Documentation](https://docs.cerebras.ai)
- [React 18 Documentation](https://react.dev)

## Goals

### Parent Goal 1: Setup and Basic Integration (Day 1 Morning)
- [x] Create Vite React project with TypeScript
- [x] Install Excalidraw and dependencies
- [x] Set up Cerebras API service
- [x] Configure environment variables
- [x] Create basic project structure
- [x] Test Excalidraw rendering

### Parent Goal 2: Cerebras Integration and Generation (Day 1 Afternoon)
- [x] Implement Cerebras service class
- [x] Create generation dialog component
- [x] Add prompt templates and examples
- [x] Test generation speed with simple components
- [x] Add placeholder rectangles to canvas
- [x] Implement generation time tracking

### Parent Goal 3: Overlay System Implementation (Day 2 Morning)
- [x] Create AppOverlay component for positioning
- [x] Implement GeneratedApp component with dynamic rendering
- [x] Sync overlay positions with Excalidraw viewport
- [x] Handle zoom and pan transformations
- [x] Test with multiple generated components
- [x] Add error boundaries for component failures

### Parent Goal 4: Synchronization and Performance (Day 2 Afternoon)
- [x] Implement viewport change listeners
- [x] Handle element deletion and updates
- [x] Optimize re-render performance
- [x] Test with 10+ simultaneous apps
- [x] Add position persistence
- [x] Implement drag constraints

### Parent Goal 5: Polish and UX Enhancement (Day 3 Morning)
- [ ] Add generation stats dashboard
- [ ] Implement keyboard shortcuts (Cmd/Ctrl+G for generate)
- [ ] Add smooth animations and transitions
- [ ] Create better loading and error states
- [ ] Implement app management (delete, regenerate)
- [ ] Add copy code functionality

### Parent Goal 6: Demo Preparation (Day 3 Afternoon)
- [ ] Create demo script with timing
- [ ] Prepare 10 example prompts of varying complexity
- [ ] Record performance metrics
- [ ] Create screen recording setup
- [ ] Test full workflow end-to-end
- [ ] Document any issues and solutions

## Implementation Notes

### Key Technical Decisions
- **Canvas**: Excalidraw library for professional whiteboard features
- **AI Model**: Cerebras Llama 3.1 70B (or Qwen3 Coder when available)
- **Component Format**: Single-file components with inline styles
- **Rendering**: Overlay system with absolute positioning
- **State Management**: Local React state (no external state library)

### Component Generation Requirements
```javascript
// Required format for generated components
const Component = () => {
  // All styles must be inline objects
  const styles = { /* ... */ };
  // Use only React built-in hooks
  // No external dependencies
  return <div style={styles.container}>...</div>;
};
```

### Overlay Synchronization Formula
```javascript
// Position calculation for overlays
const left = element.x * zoom + scrollX;
const top = element.y * zoom + scrollY;
const width = element.width * zoom;
const height = element.height * zoom;
```

## Testing Strategy

### Generation Speed Tests
- [ ] Simple button component: Target < 2s
- [ ] Counter with state: Target < 3s
- [ ] Todo list CRUD: Target < 4s
- [ ] Calculator: Target < 5s
- [ ] Complex dashboard: Target < 6s

### Integration Tests
- [ ] Canvas loads without errors
- [ ] Generation dialog opens/closes properly
- [ ] Cerebras API connects successfully
- [ ] Placeholder rectangles appear on canvas
- [ ] Overlays render at correct positions
- [ ] Apps remain interactive after zoom/pan

### Performance Tests
- [ ] 10+ apps without lag
- [ ] Smooth zoom from 30% to 300%
- [ ] Pan across large canvas areas
- [ ] No memory leaks with component mounting
- [ ] Acceptable frame rates during interaction

## Risks & Mitigations

### Risk 1: CORS Issues with Cerebras API
**Mitigation**: Configure Vite proxy in development:
```javascript
// vite.config.js
proxy: {
  '/api/cerebras': {
    target: 'https://api.cerebras.ai',
    changeOrigin: true
  }
}
```

### Risk 2: Component Rendering Failures
**Mitigation**: 
- Wrap GeneratedApp in error boundary
- Validate generated code before execution
- Provide retry mechanism
- Show clear error messages

### Risk 3: Overlay Position Drift
**Mitigation**:
- Recalculate positions on every render
- Listen to Excalidraw onChange events
- Use requestAnimationFrame for smooth updates

### Risk 4: Generation Speed > 5 seconds
**Mitigation**:
- Optimize prompt engineering
- Use temperature 0.3 for faster inference
- Consider caching common patterns
- Have GPT-4 fallback ready

## Timeline Estimate
- **Day 1**: 8 hours (Setup + Cerebras Integration)
  - Morning: 4 hours - Project setup and Excalidraw
  - Afternoon: 4 hours - Cerebras integration and testing
  
- **Day 2**: 8 hours (Overlay System)
  - Morning: 4 hours - Overlay implementation
  - Afternoon: 4 hours - Synchronization and performance
  
- **Day 3**: 6 hours (Polish + Demo)
  - Morning: 3 hours - UX enhancements
  - Afternoon: 3 hours - Demo preparation
  
- **Total**: 22 hours over 3 days

## Success Criteria Checklist

### Must Have ✅
- [ ] Excalidraw canvas working
- [ ] AI generation < 5 seconds average
- [ ] Apps render on canvas
- [ ] Basic interaction works
- [ ] Can generate 5+ different app types
- [ ] Apps stay synced with canvas movements

### Should Have 🎯
- [ ] Error handling for bad generations
- [ ] Generation stats display
- [ ] Clean visual design
- [ ] Manual retry functionality
- [ ] 80% first-attempt success rate

### Nice to Have ⭐
- [ ] Export canvas with apps
- [ ] Copy generated code
- [ ] Keyboard shortcuts
- [ ] Animation polish
- [ ] Save/load canvas state

## Discussion

### Key Design Decisions Made
1. **Excalidraw over custom canvas**: Provides professional features immediately
2. **Overlay approach**: Simpler than modifying Excalidraw internals
3. **Single-file components**: Eliminates dependency management complexity
4. **Build-time integration**: Avoids dynamic loading complexity for POC
5. **Local development only**: Focuses on core functionality validation

### Open Questions Resolved
- Q: How to integrate React components with Excalidraw?
  - A: Use overlay layer with position synchronization
  
- Q: How to handle component execution?
  - A: Use Function constructor with React context injection
  
- Q: What if generation fails?
  - A: Show error in placeholder, provide retry button

### Next Steps After POC
1. Add conversational refinement ("make it blue", "add a button")
2. Implement dynamic module loading for production
3. Add backend generation capabilities
4. Integrate with bit.dev for component publishing
5. Add collaboration features using Excalidraw's built-in support

## Relevant Files Created/Modified

### Application Files
- `apps/ai-whiteboard-poc/src/App.tsx` - Main app component that renders ExcalidrawCanvas
- `apps/ai-whiteboard-poc/src/App.css` - Simplified styles for full-screen canvas
- `apps/ai-whiteboard-poc/src/index.css` - Reset styles for full viewport usage
- `apps/ai-whiteboard-poc/src/main.tsx` - Entry point with lint fixes

### Components
- `apps/ai-whiteboard-poc/src/components/ExcalidrawCanvas.tsx` - Main canvas component with Excalidraw integration
- `apps/ai-whiteboard-poc/src/components/GenerationDialog.tsx` - AI prompt dialog for component generation

### Services
- `apps/ai-whiteboard-poc/src/services/cerebras.ts` - Cerebras API service for AI generation

### Configuration
- `apps/ai-whiteboard-poc/.env.local` - Environment variables with Cerebras API key
- `apps/ai-whiteboard-poc/package.json` - Project dependencies

## Example Test Prompts

### Complexity Level 1 (Target: <2s)
- "Create a button that changes color when clicked"
- "Make a text input with character counter"
- "Build a toggle switch with on/off states"

### Complexity Level 2 (Target: <3s)
- "Create a counter with increment and decrement buttons"
- "Make a color picker that shows hex value"
- "Build a progress bar with percentage display"

### Complexity Level 3 (Target: <4s)
- "Create a todo list with add and delete functionality"
- "Make a timer with start, pause, and reset controls"
- "Build a simple note card with title and content"

### Complexity Level 4 (Target: <5s)
- "Create a calculator with basic math operations"
- "Make a markdown editor with live preview"
- "Build a weather widget with temperature and conditions"

### Complexity Level 5 (Target: <6s)
- "Create a kanban board with draggable cards"
- "Make an expense tracker with categories and totals"
- "Build a quiz app with score tracking"

## Code Snippets for Quick Reference

### Cerebras API Call Template
```javascript
const response = await fetch(CEREBRAS_API_URL, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    model: 'llama3.1-70b',
    messages: [
      { role: 'system', content: systemPrompt },
      { role: 'user', content: userPrompt }
    ],
    temperature: 0.3,
    max_tokens: 2000,
  }),
});
```

### Overlay Position Sync
```javascript
useEffect(() => {
  const handleChange = () => {
    forceUpdate(); // Re-render overlays
  };
  excalidrawAPI.onChange(handleChange);
  return () => excalidrawAPI.offChange(handleChange);
}, [excalidrawAPI]);
```

### Dynamic Component Rendering
```javascript
const func = new Function('React', `
  const { useState, useEffect, useRef } = React;
  ${generatedCode}
  return Component;
`);
const Component = func(React);
```

This POC will validate the core value proposition: **AI-generated React apps appearing on an infinite canvas in under 5 seconds!**